<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>📺 لايف سبورت</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="refresh" content="300">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Tajawal', sans-serif;
    background: #121212;
    color: #ddd;
    overflow-x: hidden;
    padding-bottom: 100px;
  }
  header {
    text-align: center;
    padding: 20px;
    color: #4db6ac;
    text-shadow: 0 0 8px #4db6ac;
  }
  .search-box {
    text-align: center;
    margin: 10px auto;
  }
  .search-box input {
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid #4db6ac;
    width: 80%;
    max-width: 320px;
    font-size: 14px;
    background: #222;
    color: #ddd;
  }
  .search-box input::placeholder {
    color: #aaa;
  }
  .channel-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    padding: 10px;
    max-width: 800px;
    margin: auto;
  }
  .channel-card {
    position: relative;
    background: #1e1e1e;
    border: 2px solid #4db6ac;
    border-radius: 12px;
    padding: 12px;
    text-align: center;
    font-size: 13px;
    transition: 0.3s;
    transform: scale(0.95);
    color: #ddd;
  }
  .channel-card:hover {
    transform: scale(1);
    box-shadow: 0 0 15px #4db6ac;
    border-color: #26a69a;
  }
  .live-tag {
    position: absolute;
    top: 8px;
    left: 8px;
    background: #d32f2f;
    color: #fff;
    font-size: 11px;
    padding: 3px 6px;
    border-radius: 6px;
    font-weight: 700;
    letter-spacing: 0.5px;
  }
  button {
    background: #26a69a;
    border: none;
    color: #fff;
    padding: 8px 14px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    margin-top: 10px;
    transition: background 0.3s;
  }
  button:hover {
    background: #1d7c73;
  }
  .popup-player {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #121212;
    padding: 15px;
    border-radius: 15px;
    z-index: 9999;
    width: 90%;
    max-width: 800px;
    box-shadow: 0 0 25px #26a69a;
  }
  .popup-player video {
    width: 100%;
    border-radius: 15px;
    background: #000;
  }
  .close-btn {
    background: #d32f2f;
    color: #fff;
    border: none;
    padding: 6px 14px;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: 600;
  }
  .refresh-btn {
    background: #4db6ac;
    color: #121212;
    border: none;
    padding: 8px 16px;
    border-radius: 12px;
    font-size: 15px;
    cursor: pointer;
    font-weight: 700;
    transition: background 0.3s;
  }
  .refresh-btn:hover {
    background: #26a69a;
    color: #fff;
  }

  /* تعليقات: تنسيق بسيط */
  #comments-section { margin-top: 30px; }
  #comments-list p { margin: 6px 0; color: #ddd; }
  #comments-list .meta { font-size:11px; color:#9e9e9e; margin-bottom:4px; }
</style>
</head>
<body>

<header>
  <h1>⚽ لايف سبورت</h1>
  <p>📣 تابعنا على <a href="https://t.me/alialiah123456" target="_blank" style="color:#4db6ac;">التليجرام</a></p>
  <button class="refresh-btn" onclick="location.reload()">🔄 تحديث الصفحة</button>
</header>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="🔍 ابحث عن قناة...">
</div>

<section class="channel-grid" id="channelGrid"></section>

<!-- قسم التعليقات (موجود في الصفحة) -->
<div id="comments-section" style="max-width:800px;margin:auto;padding:20px;">
  <h2 style="color:#4db6ac;text-align:center;">💬 التعليقات</h2>
  <form id="comment-form">
    <textarea id="comment-text" placeholder="اكتب تعليقك..." required style="width:100%;height:80px;padding:8px;border-radius:6px;border:1px solid #4db6ac;color:#121212;"></textarea>
    <button id="comment-submit" type="submit" style="background:#26a69a;color:#fff;padding:8px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:600;margin-top:8px;">نشر</button>
  </form>
  <div id="comments-list" style="margin-top:20px;"></div>
</div>

<div class="popup-player" id="popupPlayer">
  <video id="mainPlayer" controls autoplay></video>
  <br>
  <button onclick="document.getElementById('mainPlayer').requestFullscreen()">⛶ ملء الشاشة</button>
  <button class="close-btn" onclick="closePopup()">❌ إغلاق</button>
</div>

<script>
/* --- قنوات (مثل ما أرسلت) --- */
const channels = [
  { name: 'قناة 1', quality: 'HD', url: 'https://stream.sainaertebat.com/hls2/varzeshtest.m3u8' },
  { name: 'قناة 2', quality: 'HD', url: 'https://solhtvhls.wns.live/hls/stream.m3u8' },
  { name: 'قناة 3', quality: 'HD', url: 'https://server10.mp3quran.net/ajm/128/018.mp3' },
  { name: 'قناة 4', quality: 'HD', url: 'https://stream.sainaertebat.com/hls2/bein1.m3u8' },
  { name: 'قناة 5', quality: 'HD', url: 'http://avrstream.com:1935/live/' },
  { name: 'قناة 6', quality: 'HD', url: 'https://v.redd.it/5svby2yfhj6f1/HLS_AUDIO_128.m3u8' },
  { name: 'قناة 7', quality: 'HD', url: 'http://m.live.net.sa:1935/live/quran/playlist.m3u8' },
  { name: 'قناة 8', quality: 'HD', url: 'https://cdn.karwan.tv/nrt-sport/tracks-v1a1/mono.m3u8' },
  { name: 'قناة 9', quality: 'HD', url: 'https://svs.itworkscdn.net/smc4sportslive/smc4.smil/playlist.m3u8' },
  { name: 'قناة 10', quality: 'HD', url: 'https://dmitwlvvll.cdn.mgmlcdn.com/dubaisportshd5/smil:dubaisportshd5.smil/chunklist_b1600000.m3u8' }
];

function renderChannels(list = channels) {
  const container = document.getElementById('channelGrid');
  container.innerHTML = '';
  list.forEach(ch => {
    const card = document.createElement('div');
    card.className = 'channel-card';
    card.innerHTML = `
      <div class="live-tag">مباشر</div>
      <h3>${ch.name}</h3>
      <p style="font-size:11px;color:#80cbc4;">${ch.quality}</p>
      <button onclick="openPopup('${ch.url}')">مشاهدة</button>
    `;
    container.appendChild(card);
  });
}

function openPopup(url) {
  const popup = document.getElementById('popupPlayer');
  const player = document.getElementById('mainPlayer');
  player.src = url;
  popup.style.display = 'block';
}
function closePopup() {
  const popup = document.getElementById('popupPlayer');
  const player = document.getElementById('mainPlayer');
  player.pause();
  player.src = '';
  popup.style.display = 'none';
}

document.getElementById('searchInput').addEventListener('input', function() {
  const term = this.value.toLowerCase();
  const filtered = channels.filter(ch => ch.name.toLowerCase().includes(term));
  renderChannels(filtered);
});

document.addEventListener('DOMContentLoaded', () => {
  renderChannels();
});

/* =========================
   نظام التعليقات عبر JSONBin
   ========================= */

/* بيانات الـ bin (جاهزة) */
const BIN_ID = "66bdef64acd3cb34a8831691";
const API_KEY = "$2a$10$ZzNw0Q/7AwrY7YGP4TzW1u1DgxN1b3i6kJrJD8t0JQGAtT4Stq5Fi";
const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

const commentForm = document.getElementById('comment-form');
const commentText = document.getElementById('comment-text');
const commentsList = document.getElementById('comments-list');
const submitBtn = document.getElementById('comment-submit');

/* دالة لتشفير النص حتى ما يسمح بعرض HTML خام (حماية XSS) */
function escapeHtml(str) {
  if (!str) return '';
  return str
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

/* جلب بيانات البين */
async function getBinRecord() {
  try {
    const res = await fetch(API_URL, {
      headers: { "X-Master-Key": API_KEY }
    });
    if (!res.ok) {
      console.error('JSONBin GET error', res.status);
      return { comments: [] };
    }
    const data = await res.json();
    return data.record || { comments: [] };
  } catch (err) {
    console.error('getBinRecord error', err);
    return { comments: [] };
  }
}

/* تحميل وعرض التعليقات */
async function loadComments() {
  commentsList.innerHTML = '<p style="color:#9e9e9e">جارٍ تحميل التعليقات...</p>';
  const record = await getBinRecord();
  const arr = Array.isArray(record.comments) ? record.comments : [];
  if (arr.length === 0) {
    commentsList.innerHTML = '<p style="color:#9e9e9e">لا توجد تعليقات بعد. كُن أول من يعلق!</p>';
    return;
  }
  commentsList.innerHTML = arr.map(c => {
    // كل تعليق نعرضه بعد تشفيره
    return `<div><div class="meta">${escapeHtml(c.name || 'مجهول')} — ${escapeHtml(c.time || '')}</div><p>${escapeHtml(c.text)}</p></div>`;
  }).join('');
}

/* وظيفة لإضافة تعليق جديد */
async function addCommentToBin(text) {
  submitBtn.disabled = true;
  submitBtn.textContent = 'جاري النشر...';
  try {
    // جلب أحدث نسخة حتى لا نكتب فوق أي تحديث
    const record = await getBinRecord();
    const arr = Array.isArray(record.comments) ? record.comments : [];

    // إضافة تعليق مع وقت واسم افتراضي
    const newComment = {
      name: 'زائر',
      time: (new Date()).toLocaleString('ar-EG'),
      text: text
    };
    arr.push(newComment);

    // ارفع النسخة المحدثة (PUT)
    const putRes = await fetch(API_URL, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "X-Master-Key": API_KEY
      },
      body: JSON.stringify({ comments: arr })
    });

    if (!putRes.ok) {
      throw new Error('فشل تحديث التعليقات');
    }

    // إعادة تحميل التعليقات بعد الإضافة
    await loadComments();
  } catch (err) {
    console.error('addCommentToBin error', err);
    alert('تعذر نشر التعليق الآن، حاول لاحقًا.');
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'نشر';
  }
}

/* معالجة فرم التعليق */
commentForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const text = commentText.value.trim();
  if (!text) {
    alert('الرجاء كتابة تعليق.');
    return;
  }
  await addCommentToBin(text);
  commentText.value = '';
});

/* تحميل التعليقات عند بدء الصفحة */
loadComments();

</script>

</body>
</html>
